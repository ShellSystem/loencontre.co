language: php

php:
  - 5.6


branches:
  only:
  - master
  - development


addons:
    apt:
        packages:
            - sshpass


before_script:
  - php SourceBackend/laravel/artisan key:generate
  - mysql -e 'create database goodfirm_entregas;'
  - mysql goodfirm_entregas < goodfirm_entregas.sql

script:
- SourceBackend/laravel/vendor/bin/phpunit SourceBackend/laravel/tests/UnitTest
- SourceBackend/laravel/vendor/bin/phpunit SourceBackend/laravel/tests/IntegrationTest

after_success:
  - git clone https://github.com/entregascontinuas/loencontre.co.git
  - cd loencontre.co
  - git config --global user.email $EMAIL_GITHUB
  - git config --global user.name $USER_GITHUB
  - git merge origin/development -m "Integración desde Travis CI"
  - git add .
  - git commit -m "Integración desde Travis CI"
  - git remote set-url origin https://$USER_GITHUB:$PASS_GITHUB@github.com/entregascontinuas/loencontre.co.git
  - git push origin master
  - sshpass -p $PASS_DEPLOY_SERVER ssh $USER_DEPLOY_SERVER@$IP_DEPLOY_SERVER -o StrictHostKeyChecking=no "./deploy.sh"


notifications:
  email:
    recipients:
      - alvaro.hernandez01@uptc.edu.co
      - andresmauriciogomezr@gmail.com
      - larryportocarrero@gmail.com
    on_success: always
    on_failure: always